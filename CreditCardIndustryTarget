proc import datafile="H:\Assignment5\CreditCard.csv" dbms=csv out=bank2 replace;
DELIMITER=',';
run;
proc print data=bank2(obs=10); run;
proc logistic data=bank2 descending;
 Model Active = Affinity Rewards limit numcard dm ds ts gold platinum quantum/expb stb;
 run;

proc freq data=bank2; table dm active;run;
proc freq data=bank2; table dm*active;run;

proc freq data=bank2; table ts*active;run;
proc freq data=bank2; table gold*active;run;
proc freq data=bank2; table platinum*active;run;
proc freq data=bank2; table quantum*active;run;
proc qlim data = bank2;
Model profit = totalfee affinity rewards limit numcard dm ds ts gold platinum quantum;
run;
proc qlim data = bank2;
Model profit = totalfee affinity rewards limit numcard dm ds ts gold platinum quantum;
endogenous profit ~ censored=(lb=0)
run;
proc qlim data=bank2;
Model active = affinity rewards limit numcard dm ds ts gold platinum quantum/discrete;
Model profit = totalfee affinity rewards limit numcard dm ds ts gold platinum quantum/select(active=1);
run;
data ketchup1;
INFILE 'H:\Assignment5\ketmk1l20.dat';
input HID STID WEEK BR P1 P2 P3 P4 D1 D2 D3 D4 F1 F2 F3 F4 INC NMEMB TOT DOLSPENT KID L1 L2 L3 L4;
run;
proc print data=ketchup1(obs=30);run;
data newketchup (keep= pid decision Brand Pr Di Ft Lo nmemb kid inc) ;                                                                                                                              
set ketchup1;                                                                                                                                                                                    
array Pvec{4} P1-P4;                                                                                                                                                                         
array Dvec{4} D1-D4;                                                                                                                                                                         
array Fvec{4} F1-F4;                                                                                                                                                                         
array Lvec{4} L1-L4;                                                                                                                                                                         
retain pid 0;                                                                                                                                                                                
pid+1;                                                                                                                                                                                       
do i=1 to 4;                                                                                                                                                                                 
Brand=i;                                                                                                                                                                                     
Pr=Pvec{i};                                                                                                                                                                                  
Di=Dvec{i};                                                                                                                                                                                  
Ft=Fvec{i};                                                                                                                                                                                  
Lo=Lvec{i};                                                                                                                                                                                  
decision= (BR=i);                                                                                                                                                                            
output;                                                                                                                                                                                      
end;                                                                                                                                                                                         
run;

proc print data=newketchup (obs=100);
run;
data ket;                                                                                                                                                                                     
set newketchup;                                                                                                                                                                                     
if Brand=1 then Br1=1;                                                                                                                                                                       
else Br1=0;                                                                                                                                                                                  
if Brand=2 then Br2=1;                                                                                                                                                                       
else Br2=0;                                                                                                                                                                                  
if Brand=3 then Br3=1;                                                                                                                                                                       
else Br3=0;                                                                                                                                                                                  
run;                                                                                                                                                                                         
ods html;                                                                                                                                                                                             
data ket1;                                                                                                                                                                                     
set ket;                                                                                                                                                                                      
Income1=Inc*Br1;                                                                                                                                                                                
Income2=Inc*Br2;                                                                                                                                                                                
Income3=Inc*Br3;                                                                                                                                                                                
NM1=Nmemb*Br1;                                                                                                                                                                               
NM2=Nmemb*Br2;                                                                                                                                                                               
NM3=Nmemb*Br3;                                                                                                                                                                               
KID1=Kid*Br1;                                                                                                                                                                                
KID2=Kid*Br2;                                                                                                                                                                                
KID3=Kid*Br3;                                                                                                                                                                                
run;                                                                                                                                                                                            
                                                                                                                                                                                             
proc mdc data=ket1 outest=est;                                                                                                                                                                 
model decision=Br1 Br2 Br3 Pr Di Ft Lo nm1 nm2 nm3 kid1 kid2 kid3 Income1 Income2 Income3/type=clogit nchoice=4 optmethod=qn covest=hess;                                                                         
id pid;                                                                                                                                                                                      
run;

proc means data=ket1;                                                                                                                                                                          
var Pr Di Ft Lo nm1 nm2 nm3 kid1 kid2 kid3 Income1 Income2 Income3;                                                                                                                                   
class Brand;                                                                                                                                                                                 
run;
proc bchoice data=newketchup seed=123 nmc=1000 thin=2 nthreads=4;
class pid Di KID Ft Brand;
Model Decision= Pr Lo Di Ft/ choiceset=(pid);
random NMEMB KID INC / subject=pid type=un;
run;
